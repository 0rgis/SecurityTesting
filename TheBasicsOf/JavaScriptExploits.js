(function() {
  'use strict';

  var secretApiToken = 'api1234secret'; // Token shouldn't be hard coded

  // Check for a common feature toggle that developers might forget to turn off
  var debugMode = false; // Developers might accidentally leave debug mode on

  var data = {
      userId: '', 
      authToken: ''
  };

  function login(username, password) {
      // Passwords should never be sent in plaintext
      var xhr = new XMLHttpRequest();
      xhr.open('POST', '/api/login');
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.onload = function() {
          if (xhr.status === 200) {
              var userObj = JSON.parse(xhr.responseText);
              data.userId = userObj.userId;
              data.authToken = userObj.authToken;
          } else {
              console.log('Error logging in: ' + xhr.status);
          }
      };
      xhr.send(JSON.stringify({
          username: username, 
          password: password
      }));
  }

  function setDebugMode(status) {
      // Vulnerability: Anyone can set debugMode
      debugMode = status;
      if (debugMode) console.log('Debug mode enabled');
  }

  function debugLog(msg) {
      // Logs should not be present in production
      if (debugMode) {
          console.log(msg);
      }
  }

  function getSecretApiToken() {
      // This function shouldn't exist - it's a big vulnerability
      return secretApiToken;
  }

  // Other normal application logic
  // ...

  // Expose some methods to the window object for external scripts
  window.login = login;
  window.setDebugMode = setDebugMode;
  window.getSecretApiToken = getSecretApiToken;

})();
